# 3. Log Ingestion

Log Ingestion is the process through with Log Data is brought into Dynatrace. 

As discussed in [1. Log Monitoring](1.%20Log%20Monitoring.md), Dynatrace accepts logs from/through 4 different sources:
1. OneAgent
2. Cloud Providers
	- AWS
	- Azure
	- GCP
3. Open Source
4. Generic Log Ingest (Dynatrace API)

## Before setting up Log Ingestion
Few items need your attention before setting up Dynatrace Log Monitoring
1. [Supported log data formats](https://www.dynatrace.com/support/help/shortlink/log-monitoring-supported-format)
	
	[Supported log data formats](https://www.dynatrace.com/support/help/shortlink/log-monitoring-supported-format) is a guide to how built-in parsing rules work in Dynatrace. If the logs are not in the supported format, you will have to create parsing rules to extract the basic values like timestamp and status/log severity (we will be covering this later in this course). Please read the doc for more information but here are some important points:
	- Log severity is detected through a keyword search on the first 100 characters in log line. This can be adjusted in `Dynatrace Settings > Log Monitoring > OneAgent settings`
	- Plain-text logs (.txt) are valid as long as it meets requirements mentioned in the doc.
	- Any log entry with unsupported/unrecognized timestamp will have the ingestion time as the `timestamp` value. See [Supported timestamp formats](https://www.dynatrace.com/support/help/how-to-use-dynatrace/log-monitoring/log-monitoring-configuration/timestamp-data-format).  However, this can be corrected using [Timestamp rules](https://www.dynatrace.com/support/help/shortlink/log-monitoring-timestamp-configuration#timestamp-rules) created at Host, HostGroup or Environment levels under respective level (Host/HostGroup/Global) `Settings` page -  `Settings > Log Monitoring`.

2. [Connecting log data to traces](https://www.dynatrace.com/support/help/shortlink/log-monitoring-log-enrichment)
   
	Dynatrace provides the ability to connect log entries to Dynatrace traces (PurePaths). This is a 2 step process:
	1. Dynatrace OneAgent enriches log entries with `dt.trace_id`, `dt.span_id` & `dt.entity.process_group_instance` values for supported frameworks as described in [Connecting log data to traces](https://www.dynatrace.com/support/help/shortlink/log-monitoring-log-enrichment) doc. 
	   
	   **Automatic Log Enrichment**
	   
	   This is where Dynatrace OneAgent automatically adds these fields to log lines before sending them to Dynatrace Server. See [Automatic Log Enrichment steps](https://www.dynatrace.com/support/help/shortlink/log-monitoring-log-enrichment#enabledisable-automatic-log-enrichment-for-a-specific-technology) 
	   
	   **Limitation**: 
	   - OneAgent based automatic log enrichment can only be done for `structured` logs and for [supported frameworks](https://www.dynatrace.com/support/help/shortlink/log-monitoring-log-enrichment#supported-frameworks). 
	   - Enabling Automatic log enrichment on `unstructured` logs may cause issues with other log management systems ingesting the same logs.
	   
	   **Manual Log Enrichment** 
	   Available [OneAgent v1.239+](Checklists/Minimum%20Dynatrace%20Versions.md)
	   Log Entries can also be enriched using custom configuration on supported technologies. For details see [Manual log enrichment steps](How-tos/Manual%20log%20enrichment%20steps.md).  
	   Manual Log Enrichment is also useful for logs that come through Sources other than OneAgent.
	   
	2. Dynatrace Server uses this extra data/fields to connect Log entries to traces (PurePaths). 
	
3. [Sensitive data masking](https://www.dynatrace.com/support/help/shortlink/log-monitoring-mask-sensitive-data)
	
	Sensitive data masking rules can be created to prevent sensitive data like email, url parameters and others being sent by Dynatrace OneAgents to Dynatrace Server. These rules added through Dynatrace UI can either hide or replace content on OneAgent side even before the data is sent to Dynatrace.

	The data masking rules can be applied environment wide, within a host group or to an individual host (using respective `Settings > Log monitoring`). Precedence is in the order Host, HostGroup and Environment respectively.

	See [Create rule](https://www.dynatrace.com/support/help/shortlink/log-monitoring-mask-sensitive-data#create-rule) section of doc for steps and examples.

## Log Ingestion setup

Next lets go through the different log ingestion setups.
- [OneAgent](3.1%20OneAgent.md)
- [Cloud Providers](3.2%20Cloud%20Providers.md)
- [Open Source](3.3%20Open%20Source.md)
- [Generic log ingest (Dynatrace API)](3.4%20Generic%20log%20ingest%20(Dynatrace%20API).md)

### NEXT: [OneAgent Log Ingest](3.1%20OneAgent.md)